<html>
<head>
<title>Team8AIGame</title>
<style type="text/css">
<!--
/*
    This style sheet is borrowed from the NetLogo User Manual.  However, some of the units were
    changed from em to px because Java's StyleSheet support is limited for relative units such as
    em and % (this will supposively improve with newer versions of the VM) - jrn 7/21/05
    BE VERY VERY CAREFUL when you alter this style sheet -- it's possible to put in
    innocent-looking things that work on some VM's but cause Java exceptions on other for example
    we were using "font-size: 125%" but it caused Java exceptions on Java 1.5 on Windows - ST
    8/25/05
*/
:link { color: rgb(110,0,110); }
:visited { color: rgb(110,0,110); }
body {
    margin-left: 5px;
    font-family: arial, sans-serif;
    background: white;
    font-size: 12pt
}
h1 {
    color: white;
    background: rgb(45,0,45);
    font-size: 18pt;
    margin-bottom: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h2 {
    margin-top: 15px;
    margin-left: 6px;
    margin-bottom: 4px;
    background: rgb(166,172,255);
    font-size: 15pt;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h3 {
    margin-top: 15px;
    margin-left: 13px;
    margin-bottom: 4px;
    background: rgb(175,175,175);
    font-size: 12pt;
    padding: 0.2em;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    margin-left: 15px;
    font-size: 12pt;
}
h5 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
h6 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
p {
    margin-left: 15px;
    margin-bottom: 3px;
}
pre {
    margin-left: 13px;
    background: rgb(225,225,225);
    font-family: monospace;
    font-size: 12pt;
    padding-left: 10px;
    padding-right: 3px;
    padding-top: 7px;
    padding-bottom: 7px;
    margin-top:9px;
    margin-bottom:0px;
}
code {
    font-family: monospace;
    font-size: 12pt;
}
blockquote {
    border: solid;
    border-style: solid;
    border-width: thin;
    border-color: black;
    background: rgb(250,250,220);
    padding-top: 0px;
    padding-bottom: 7px;
    margin-top: 7px;
    margin-bottom:1px;
}
ol {
   margin-bottom:1px;
}
ul {
   margin-bottom:1px;
}

-->
</style>
</head>
<body>

<p><b>NOTICE:</b> The NetLogo team no longer recommends using NetLogo applets. <a href="https://github.com/NetLogo/NetLogo/wiki/Applets">Details here</a>.</p>

<p>This page was automatically generated by NetLogo 5.2-RC2.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://www.java.com/">Oracle's Java site</a>.</p>

<p><hr>

<p><font size="-1">In order for this to work, this file, your model file
(Team8AIGame.nlogo), and the files NetLogoLite.jar and NetLogoLite.jar.pack.gz
must all be in the same directory.  (You can copy NetLogoLite.jar and NetLogoLite.jar.pack.gz
from the directory where you installed NetLogo.)</font></p>

<p><font size="-1">The applet will also need access to the 
matrix extension.
Copy the entire directory for each required extension into the same
directory as the applet.</font></p>

<p><font size="-1">On some systems, you can test the applet locally on your computer
before uploading it to a web server.  It doesn't work on all systems,
though, so if it doesn't work from your hard drive, please try
uploading it to a web server.</font></p>

<p><font size="-1">You don't need to include everything in this file in your page.
If you want, you can just take the HTML code beginning with
&lt;applet&gt; and ending with &lt;/applet&gt;, and paste it into any HTML
file you want.  It's even OK to put multiple &lt;applet&gt; tags
on a single page.</font></p>

<p><font size="-1">If the NetLogoLite files and your model are in different
directories, you must modify the archive= and value= lines
in the HTML code to point to their actual locations.
(For example, if you have multiple applets in different
directories on the same web server, you may want to put
a single copy of the NetLogoLite files in one central place and
change the archive= lines of all the HTML files to point
to that one central copy.  This will save disk space for
you and download time for your users.)</font></p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar,matrix/matrix.jar,matrix/Jama-1.0.3.jar"
        width="1867" height="740">
  <param name="DefaultModel"
         value="Team8AIGame.nlogo">
  <param name="java_arguments"
         value="-Djnlp.packEnabled=true">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="Team8AIGame.nlogo">Team8AIGame.nlogo</a></p>
<h2>WHAT IS IT?</h2><p>This project is a collaberative effort to make a game involving AI consisting of four main features. The first main feature is a random maze generation algorithm, the second is an algorithm that changes the maze at runtime by isolating different &ldquo;shapes&rdquo; that make up the maze and moving them around. The third feature is an FSM controlled enemy, and the final feature is A* pathfinding for the enemy.</p><h2>HOW IT WORKS</h2><h3>Map Generation</h3><p>The map generation starts by selecting &ldquo;seed patches&rdquo;. It does this by randomly looking through all patches that are blue, when it has selected a patch it checks all of the neighbors of the patch are also blue (this makes sure that no two seed blocks are placed touching eachother). If the neighboring patches are blue then this is an ok place to put a seed block. </p><p>The second stage is generating the walls attatched to the seed blocks. We wanted to make sure that the generated walls never touch, to do this we first get all of the walls that make up the shape we are currently adding to and putting them into a list, then randomly choose a patch from that shape and then randomly choose a neighbor. Once it has chosen a neighbor it will check if it is ok to make a new wall here, to do this it will check the neighbors of this patch to see if one of the neighbors is wall of another shape. It does this by checking every neighbor against the list of walls and if only those walls are encountered we create a new wall patch. It does this until no more suitable wall patches are generated. </p><p>The third stage for the level generation is to fill in the gaps created by the wall generation, it checks all blue patches to see if any of them have all blue neighbors, and if they do it makes that patch a wall patch.</p><p>The fourth stage is the creation of the outer walls, for this we just set the outer patches to be the wall color (red).</p><p>The fith stage of the level creation is the finilization of the colors. Here we just change the colors of the patches to work with the other group members algorithms.<br/>The final stage of the level creation is the creation of the exit block for the player, this is always created in the top right of the maze.</p><h3>Changing The Maze</h3><p>After map-formation, individual tiles (Bricks) look around in four directions for neighbouring Bricks and try to form Units with them.<br/>Units stay together for the rest of the game.<br/>After Unit-formation a Unit gets selected randomly and its members ask to vote for moving or staying. If they vote to move, they re-vote for the direction of movement.<br/>This can be influenced.<br/>Finally the Unit moves (if the movement is possible) and another Unit is selectedâ€¦</p><h3>Enemy FSM</h3><p>The enemy has 4 underlying states: <strong>Wander</strong>, <strong>Seek</strong>, <strong>Catch</strong>, and <strong>Rest</strong>. These states are entered and exited under certain conditions in the simulation, and the enemy&rsquo;s own energy value.</p><p>In the <strong>Wander</strong> state, it will randomly navigate the maze.</p><p>In the <strong>Seek</strong> state, it will aggressively move towards the player.</p><p>In the <strong>Catch</strong> state, it will kill the player and end the game.</p><p>In the <strong>Rest</strong> state, it will become immobilised and regenerate energy.</p><p>The enemy requires energy for its actions. Energy is gained in the <strong>Wander</strong> and <strong>Rest</strong> states, and spent in the <strong>Seek</strong> and <strong>Catch</strong> states. </p><h3>A*</h3><p>This algorithm uses an exact heuristic function to approximate the optimal path from the enemy to the player location. It uses the concept of &lsquo;open&rsquo; and &lsquo;closed&rsquo; lists - the open list contains patches that have not yet been explored, and the closed list contains patches that have already been visited and will never be re-visited.</p><p>Each time the pahtfinding procedure is called the open list is sorted in increasing order of each item&rsquo;s f() cost. The first patch to be explored will always be the first item in the open list, as it will always hold the lowest approximated cost from the enemy to the player location. </p><p>This exploration of patches loops until the destination has been reached or the open list has been exhausted - indicating there is no possible patch from the enemy to the player.</p><p>The path is then stored in a variable, and the enemy is moved one along this path.</p><p>Then the source position is updated to match the new enemy position, as the source position will need to be passed into the pathfinding procedure the next time it is called to calculate the path. </p><p>Finally, this whole procedure is repeated until the enemy has reached the destination patch.</p><h2>HOW TO USE IT</h2><h3>Setup</h3><p>Press the Generate Map button to generate the map, then press &ldquo;Call Base Setup&rdquo; to initialise the game.<br/>Press the start button to start the game. </p><h3>Playing The Game</h3><p>Use the WASD or the on-screen keys to move the character. Try to get to the exit tile (violet patch). You can also experiment with the settings, which will be detailed below.</p><h2>THINGS TO NOTICE</h2><p>-Shapes do not form touching eachother<br/>-The exit always spawns on the top right, the player on the bottom left.<br/>-Wall Shapes tend to keep their form and don&rsquo;t merge with others.<br/>-Wall shapes never crash into each other or push each other.<br/>-The enemy states in the monitor.<br/>-The enemy energy value in the monitor.<br/>-The player can&rsquo;t move through the walls.<br/>-The pathfinding procedure is called every time the player and enemy move.<br/>-No matter what the maze is the A* algorithm finds the target quickly due to sorting of the open list.</p><h2>THINGS TO TRY</h2><p>You can change : TODO things to change<br/>- Try to turn on the &ldquo;showWallLabels&rdquo;, this way you can see which wall sections belong together.<br/>- Moving the X slider, the bigger the number it is, the more percentage the actual units need to vote yes to move the selection.<br/>- Try to select an option from the PreferedDirection to make the wall prefer to move to a certain direction.<br/>- Set the directionPreferenceIncluence which is a precentige how likely they will take your selected direction<br/>- Adjust the weighting sliders, and see what effect they have on the enemy&rsquo;s movement.<br/>- Replace A* with a different algorithm. </p><h2>NETLOGO FEATURES</h2>
<ul>
  <li>matrices</li>
  <li>agentsets</li>
  <li>includes</li>
  <li>lists</li>
  <li>neighbours4</li>
  <li>sort-by</li>
</ul><h2>We can make these</h2><h2>CREDITS AND REFERENCES</h2><p>Maze Generaiton : Calum Brown<br/>Obstacle Movement : ZoltÃ¡n Tompa<br/>Enemy FSM and Player : Euan McMenemin<br/>A* Implementarion : Adrian Lis</p>

<h1>CODE</h1>
<pre><font color="#5a5a5a">;;Includes for each of the seperate code files written by all members.</font><font color="#000000">
</font><font color="#007f69">__includes</font><font color="#000000">[</font><font color="#963700">&quot;mapgen.nls&quot;</font><font color="#000000"> </font><font color="#963700">&quot;wallAI_2.nls&quot;</font><font color="#000000"> </font><font color="#963700">&quot;EnemyFSM.nls&quot;</font><font color="#000000"> </font><font color="#963700">&quot;Pathfinding.nls&quot;</font><font color="#000000"> </font><font color="#963700">&quot;PlayerControl.nls&quot;</font><font color="#000000">]

</font><font color="#5a5a5a">;;This allows matrices to be used.</font><font color="#000000">
</font><font color="#007f69">extensions</font><font color="#000000"> [matrix]

</font><font color="#007f69">to</font><font color="#000000"> baseUpdate
  
</font><font color="#0000aa">ifelse</font><font color="#000000"> GameStarted </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000">
[
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> (</font><font color="#963700">21</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> wallSpeed) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)
  [
    moveUnit  
  ]
  
  </font><font color="#5a5a5a">;;Update Enemy</font><font color="#000000">
  updateEnemyState
]
[
  </font><font color="#0000aa">ifelse</font><font color="#000000"> Victory </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000">
  [
    </font><font color="#5a5a5a">;;If the player has won, display the victory screen</font><font color="#000000">
    playerwins
    moveunit
  ]
  [
    </font><font color="#5a5a5a">;;Otherwise, the game over screen</font><font color="#000000">
    gameOver
    moveUnit
  ]
]


</font><font color="#0000aa">tick</font><font color="#000000">
</font><font color="#0000aa">wait</font><font color="#000000"> </font><font color="#963700">0.1</font><font color="#000000">

</font><font color="#007f69">end</font><font color="#000000">





</font><font color="#5a5a5a">;;******************************************************************************************************</font><font color="#000000">

</font><font color="#007f69">globals</font><font color="#000000"> 
[
  GameStarted    </font><font color="#5a5a5a">;;Boolean indicator for the game's playing state.  When this is true, the player can move and the enemy will move.</font><font color="#000000">
  Victory        </font><font color="#5a5a5a">;;Boolean indicator for whether the player has won or not.</font><font color="#000000">
]

</font><font color="#007f69">patches-own</font><font color="#000000">
[
 innerLabel 
]

</font><font color="#660096">breed</font><font color="#000000"> [enemies enemy ]
</font><font color="#660096">breed</font><font color="#000000"> [players player ]

</font><font color="#007f69">enemies-own</font><font color="#000000"> 
[ 
  state           </font><font color="#5a5a5a">;;Enemy state </font><font color="#000000">
  energy          </font><font color="#5a5a5a">;;Energy is an integer value representing the energy.</font><font color="#000000">
  isResting       </font><font color="#5a5a5a">;;isResting is a boolean flag indicating the enemy is in the regenerating part of the resting state.</font><font color="#000000">
  current-path    </font><font color="#5a5a5a">;;part of the path that is left to be traversed </font><font color="#000000">
]

</font><font color="#007f69">to</font><font color="#000000"> baseSetup

  
  </font><font color="#5a5a5a">;;Initialise variables</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> GameStarted </font><font color="#963700">false</font><font color="#000000">
  </font><font color="#5a5a5a">;Initialise exit patch variable (1 1 being arbitry)</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> exitPatch </font><font color="#660096">patch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> 
  </font><font color="#0000aa">let</font><font color="#000000"> playercount </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> spawnPatch </font><font color="#660096">patch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> 
  </font><font color="#5a5a5a">;;Get Exit patch</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">violet</font><font color="#000000">]
  [
    </font><font color="#0000aa">set</font><font color="#000000"> exitPatch </font><font color="#660096">self</font><font color="#000000">
  ]
  </font><font color="#5a5a5a">;;Create players</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000">]
  [
    </font><font color="#0000aa">let</font><font color="#000000"> sDistance [</font><font color="#660096">distance</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> exitPatch
    </font><font color="#0000aa">if</font><font color="#000000"> playerCount </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">
    [
       </font><font color="#0000aa">if</font><font color="#000000"> sDistance </font><font color="#660096">&gt;</font><font color="#000000"> spawnDistance
       [
         </font><font color="#0000aa">set</font><font color="#000000"> playerCount playerCount </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> spawnPatch </font><font color="#660096">self</font><font color="#000000">
         sprout-players </font><font color="#963700">1</font><font color="#000000">
         [
           </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch-here</font><font color="#000000"> 
           [
             </font><font color="#0000aa">set</font><font color="#000000"> innerLabel </font><font color="#963700">&quot;destination&quot;</font><font color="#000000"> 
           ]
         ]
       ]
       
    ]
  ]
  
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> innerLabel </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;destination&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> [</font><font color="#660096">distance</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> spawnPatch </font><font color="#660096">&gt;</font><font color="#000000"> spawnDistance]
  [
    </font><font color="#5a5a5a">;;Create enemies</font><font color="#000000">
    sprout-enemies </font><font color="#963700">1</font><font color="#000000"> 
    [
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> energy </font><font color="#963700">100</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> isResting </font><font color="#963700">false</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> state </font><font color="#963700">&quot;&quot;</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> current-path </font><font color="#963700">&quot;&quot;</font><font color="#000000">
    ]
  ] 
  
  
  
  </font><font color="#5a5a5a">;;Set Game Start</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> GameStarted </font><font color="#963700">true</font><font color="#000000">

</font><font color="#007f69">end</font>
</pre>

</body>
</html>
